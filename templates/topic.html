{% extends 'base.html'%}
{% from "_sidebarhelpers.html" import render_sidebar %}
{% set system = o.system_as_obj %}
{% block title %} | {{system.name}}: {{o.name}}{% endblock %}
{% block body %}
<style>
  @import url("//ajax.googleapis.com/ajax/libs/dojo/1.5/dijit/themes/tundra/tundra.css");
</style>
<script src="//ajax.googleapis.com/ajax/libs/dojo/1.5/dojo/dojo.xd.js" djConfig="parseOnLoad:true"></script>
<script>
  dojo.require('dijit.Dialog');
  dojo.require('dojo.io.script');
  dojo.require('dijit.form.Button');
</script>
<aside class="sidebar grid_3">
  {{ render_sidebar(system, user) }}
</aside>
<article class="grid_9">
  <section class="topic">
    <div style="float:right">
      <a href="{{o.permalink}}">permalink</a>
    </div>
    <h2>{{o.name}}</h2>
    <div>{{o.body|safe}}</div>
  </section>

  {% if user %}
  <section class="admin">
    <a href="{{o.url}}/edit">[edit]</a>

    <form action="{{url_for('delete_topic', system_key_name=system.key_name, category=o.category, name=o.name)}}?_method=DELETE" method="POST" style="display:inline">
      <span type="submit" dojoType="dijit.form.Button">[delete]</span>
    </form>

    <div id="dialog" dojoType="dijit.Dialog" title="Topic {{o.name}} via JSONP" style="width:350px">
      <div id="content"></div>
    </div>
    <button dojoType="dijit.form.Button" type="button">
      JSON(P)
      <script type="dojo/method" event="onClick" args="evt">
      dijit.byId("dialog").show();
      target = dojo.byId('content');
      var args = {
        url: '/plugin/{{o.uid}}/jsonp',
        callbackParamName: 'callback',
        load: function(js){
          target.innerHTML = '<h3>' + js.name + '</h3><p>' + js.body + '</p>';
        }
      }
      dojo.io.script.get(args);
      </script>
    </button>

    <span>As tooltip: <iframe src="{{o.tooltip_permalink}}" style="position:absolute" width="320" height="100%" ></iframe></span>
  </section>
  {% endif %}
</article>
{% endblock %}
